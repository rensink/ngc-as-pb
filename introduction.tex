\section{Introduction}

\begin{quote}\it
Note to reader: this is the pre-final version of the paper, complete in technical details but missing the final formulation of introduction and conclusion. This version will be replaced by the final one before June 24.
\end{quote}
%
Representing formulas of First-Order Logic (FOL) by graphs or more general graphical structures was explored in various areas of Theoretical Computer Science and Logics along the decades. 
A canonical example is represented by edge-labelled graphs, which can be regarded as an alternative syntax for formulas of a fragment of FOL including conjunction and existential quantification.\todo{AR: in line with later statements, we could call this the $\exists$-fragment}

Let $\Lab = \{\gl{a}, \gl{b}, \gl{c}, \ldots\}$ be a set of binary relation symbols, which we shall use also as edge labels. As an example, let $F$\todo{AR: Use $A$ and $B$ rather than $F$ and $F'$?} be the graph $\inline{\twoedge{x}{a}{y}{b}{z}}$. We consider it as a sound representation of the formula  $\Phi_F = \exists x,y,z\,.\, \gl{a}(x,y) \wedge \gl{b}(y,x)$, in the following sense: a graph $G$ satisfies $\Phi_F$ (or is a \emph{model} of $\Phi_F$) if and only if there is a graph morphism $h$ from $F$ to $G$. 
Now consider $F' = \inline{\oneedge{x}{a}{y}}$, representing formula $\Phi_{F'} = \exists x,y\,.\, \gl{a}(x,y)$. Graph $F'$ has an obvious inclusion morphism into $F$, viz.\ $i\of F' \to F$. Therefore every morphism $h: F \to G$ gives rise to a composed morphism $i;h\of F'\to G$, implying that every graph that satisfies $\Phi_F$ also satisfies $\Phi_{F'}$, thus $\Phi_F$ \emph{entails} $\Phi_{F'}$ (written $\Phi_F \entails \Phi_{F'}$). It is worth noting that, in this elementary framework, graph morphisms can represent both a satisfaction relation (between formulas and models) and an entailment relation among formulas.

These concepts were exploited for example by Chandra and Merlin in \cite{DBLP:conf/stoc/ChandraM77} in the framework of relational database queries. They show there that every \emph{conjunctive query} (a formula of the above fragment of FOL, but with relations of any arity) has a natural model, a graph, and query inclusion is equivalent to the existence of a graph homomorphism between those natural models. Therefore morphisms are not only sound, but also complete with respect to entailment, and it follows that query inclusion is decidable, even if NP-complete: an interesting logical result obtained with graph theoretical techniques.   

More recently,\todo{Though this provided our motivation, the connection with our current paper is weak at best; and also, we come too slowly to our own contributions. If at all, this discussion could come after we sketch what we do (providing some (currently weak) evidence that there is interest from outside GT); or it could entirely go to the future work section, where we want to come back to Bonchi et al.\ anyway.} Bonchi et.al.~\cite{DBLP:conf/csl/BonchiSS18} have enriched the correspondence between graphs and conjunctive queries of~\cite{DBLP:conf/stoc/ChandraM77} by identifying a common rich algebraic/categorical structure: \emph{cartesian bicategories}. They introduce \emph{graphical conjunctive queries} as suitable \emph{string diagrams}, i.e.~arrows of a specific free cartesian bicategory, showing that they are as expressive as standard conjunctive queries and, more interstingly, that the freely generated preorder among them is exactly the entailment preoder among queries. Furthermore, exactly the same algebraic structure is show to arises by considering as arrows cospans of hypergraphs and as preorder the existence of a morphism. This is summarized by a triangular relationship including logical structures (queries), combinatorial structures (hypergraphs), and categorical ones (free cartesian bicategories).     

Extensions of part of the above framework to larger fragments of FOL have been considered in the literature. For example, in~\cite{DBLP:journals/corr/abs-2404-18795} the authors have generalized the characterization of conjunctive formulas as arrows of a free cartesian bicategory of~\cite{DBLP:conf/csl/BonchiSS18} to full FOL, but lacking a combinatorial/graphical counterpart of formulas. 

In the realm of Graph Transformation Systems  (GTSs)
% (e.g.~in the Double-Pushout Approach~\cite{eps:gragra-algebraic})
 the need of representing formulas by graphs arose in a natural way. 
 In any approach, a rule consists of at least two graphs, $L \leadsto R$, and to apply it to a graph $G$, first a morphism $m: L \to G$ has to be found. 
 By the above discussion, we can consider $L$ as an existential-conjunctive formula that has to be satisfied by $G$, as an application condition. 

It soon turned out that in order to use GTSs for even simple specifications, more expressive application conditions were needed. 
In~\cite{NegativeAC} the authors introduced \emph{Negative Application Conditions (NACs)}, allowing to express (to some extent) negation and disjunction.  A NAC $\cN$ is  a finite set of morphisms from $L$, $\cN = \{n_i: L \to Q_i\}_{i\in[1,k]}$, and a morphism $m: L \to G$ \emph{satisfies} $\cN$ if for all $i\in[1,k]$ there is no morphism $m_i: Q_i \to G$ such that $n_i;m_i = m$. 
It follows that such a NAC represents a formula of the shape $\exists \bar{x}\st L \wedge \neg (\exists \bar{y}_1\st Q_1 \vee \ldots \vee \exists \bar{y}_n\st Q_n)$, where $L, Q_1, \ldots,Q_n$ are conjunctions describing the structure of the corresponding graphs: as in \cite{Rensink-FOL}, we denote this fragment of FOL by $\exists \neg \exists$.

Note that differently from the existential-conjunctive framework, a formula in $\exists \neg \exists$ is no longer a graph, but a diagram (a star) in \cat{Graph}, the category of graphs; and satisfaction does not require just the existence of a morphism, but also the non-existence of certain morphisms.

NACs were generalized in~\cite{Rensink-FOL,Habel-FOL} to \emph{Nested Application Condition}, where the structure of a condition is an arbitrary tree rooted at $L$, and satisfaction is defined like for NACs, but iterating furhter. As a consequence it is proved that Nested ACs have the same expressive power of full FOL.\todo{add more references to Nested AC, works by Penneman, Habel, Lambers, Orejas, K\"onig, ... ???}

Despite the fact that NACs first and Nested ACs next were defined as suitable diagrams in the category of graphs or other structures, we are not aware of any definition of morphism among such application conditions. In this paper we address exactly this issue: the main constraint we intend to meet is that the existence of a morphism between two application conditions implies that the first entails the second (thus in the opposite direction with respect to the $\exists\wedge$ fragment)\todo{AC: Say that this can be changed? AR: I would prefer if we avoid raising this point altogether}.
 
\medskip\noindent
In this paper, we first propose a notion of morphism among nested conditions that is consistent with the entailment of the corresponding formulas. This lets emerge
a structural weakness of the original definition of Nested ACs, that we overcome by proposing the original notion of Span-Based Conditions, where Nested ACs embeds. We also introduce morphisms for the latter, obtaining a number of categories suitably related by functors. \todo{Adapt summary of paper.}

Proofs are in the appendix.
\todo{AR: Rephrase}
 
 